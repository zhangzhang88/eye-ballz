#!/bin/bash

# Eye Ballz å¿«é€Ÿå¯åŠ¨è„šæœ¬
# ä½¿ç”¨æ–¹æ³•: chmod +x start.sh && ./start.sh

echo "ğŸš€ å¯åŠ¨ Eye Ballz é¡¹ç›®..."
echo ""

# æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•
if [ ! -f "package.json" ]; then
    echo "âŒ é”™è¯¯: è¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# æ£€æŸ¥ node_modules
if [ ! -d "node_modules" ]; then
    echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
    pnpm install
fi

# æ£€æŸ¥ .env æ–‡ä»¶
if [ ! -f ".env" ]; then
    echo "âš ï¸  è­¦å‘Š: æœªæ‰¾åˆ° .env æ–‡ä»¶"
    echo "è¯·åˆ›å»º .env æ–‡ä»¶å¹¶æ·»åŠ : REPLICATE_API_TOKEN=your_token"
    exit 1
fi

echo "âœ… å‡†å¤‡å°±ç»ª!"
echo ""
echo "ğŸ“‹ è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œ:"
echo ""
echo "1ï¸âƒ£  åœ¨å½“å‰ç»ˆç«¯è¿è¡Œä¸Šä¼ æœåŠ¡å™¨:"
echo "   pnpm run upload"
echo ""
echo "2ï¸âƒ£  æ‰“å¼€æ–°ç»ˆç«¯,è¿è¡Œé¢„è§ˆæœåŠ¡å™¨:"
echo "   pnpm run preview"
echo ""
echo "3ï¸âƒ£  æ‰“å¼€ç¬¬ä¸‰ä¸ªç»ˆç«¯,è¿è¡Œ Cloudflare Tunnel:"
echo "   cloudflared tunnel run eyeballz"
echo ""
echo "ğŸŒ ç„¶åè®¿é—®: https://eye.ztr8.uk"
echo ""
echo "ğŸ’¡ é¦–æ¬¡é…ç½® Cloudflare Tunnel? è¯·æŸ¥çœ‹ DEPLOY.md"
echo ""

# è¯¢é—®æ˜¯å¦ç›´æ¥å¯åŠ¨ä¸Šä¼ æœåŠ¡å™¨
read -p "ç°åœ¨å¯åŠ¨ä¸Šä¼ æœåŠ¡å™¨? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "ğŸš€ å¯åŠ¨ä¸Šä¼ æœåŠ¡å™¨ (ç«¯å£ 3000)..."
    pnpm run upload
fi
